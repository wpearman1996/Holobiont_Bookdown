<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Paper 1 - Joint consideration of selection and microbial generation count provides unique insights into evolutionary and ecological dynamics of holobionts | Holobiont Modelling Framework</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Paper 1 - Joint consideration of selection and microbial generation count provides unique insights into evolutionary and ecological dynamics of holobionts | Holobiont Modelling Framework" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Paper 1 - Joint consideration of selection and microbial generation count provides unique insights into evolutionary and ecological dynamics of holobionts | Holobiont Modelling Framework" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="William S. Pearman, Allen G. Rodrigo, Anna W. Santure" />


<meta name="date" content="2024-11-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="paper-1---effective-vertical-inheritance.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Holobiont Simulations</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html"><i class="fa fa-check"></i><b>2</b> Paper 1 - Joint consideration of selection and microbial generation count provides unique insights into evolutionary and ecological dynamics of holobionts</a>
<ul>
<li class="chapter" data-level="2.1" data-path="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#creating-offspring-function---create_offspring_loop.cpp"><i class="fa fa-check"></i><b>2.1</b> Creating offspring function - <code>create_offspring_loop.cpp</code></a></li>
<li class="chapter" data-level="2.2" data-path="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#general-simulation-wrapper-code"><i class="fa fa-check"></i><b>2.2</b> General simulation wrapper code</a></li>
<li class="chapter" data-level="2.3" data-path="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#generating-environmental-pools."><i class="fa fa-check"></i><b>2.3</b> Generating environmental pools.</a></li>
<li class="chapter" data-level="2.4" data-path="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#generating-new-microbiomes-within-a-host-generation"><i class="fa fa-check"></i><b>2.4</b> Generating new microbiomes within a host generation</a></li>
<li class="chapter" data-level="2.5" data-path="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#generating-new-hosts"><i class="fa fa-check"></i><b>2.5</b> Generating new hosts</a></li>
<li class="chapter" data-level="2.6" data-path="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#unused-functions-and-capacities"><i class="fa fa-check"></i><b>2.6</b> Unused functions and capacities</a></li>
<li class="chapter" data-level="2.7" data-path="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#running-a-simulation"><i class="fa fa-check"></i><b>2.7</b> Running a simulation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="paper-1---effective-vertical-inheritance.html"><a href="paper-1---effective-vertical-inheritance.html"><i class="fa fa-check"></i><b>3</b> Paper 1 - Effective vertical inheritance</a>
<ul>
<li class="chapter" data-level="3.1" data-path="paper-1---effective-vertical-inheritance.html"><a href="paper-1---effective-vertical-inheritance.html#running-an-effective-vi-simulation"><i class="fa fa-check"></i><b>3.1</b> Running an effective VI simulation</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Holobiont Modelling Framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Paper 1 - Joint consideration of selection and microbial generation count provides unique insights into evolutionary and ecological dynamics of holobionts<a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Here I provide a general outline for the framework presented in our paper.</p>
<div id="creating-offspring-function---create_offspring_loop.cpp" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Creating offspring function - <code>create_offspring_loop.cpp</code><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#creating-offspring-function---create_offspring_loop.cpp" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here we implementing the create offspring function, this essentially takes in a host population and generates the offspring for the subsequent host generation. We determine the individuals which reproduce elsewhere in the code, this just takes those parents and produces offspring children.</p>
<p>It functions by calculating the relative abundance of each microbe in the parent, the relative abundance in the environment, and the combines the abundances based on the relative contribution of parent vs environment to the child. The fitness of each microbial taxa in the host is determined and the product of the fitness and the relative abundance determines the sampling probability of that microbe into the offspring. The microbes are then sampled multinomially to produce the offsprings microbiome.</p>
<p>We implement this as a C++ R code, because this is executed many many times and it is very slow to run it normally in R.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-1"></a>Rcpp<span class="sc">::</span><span class="fu">sourceCpp</span>(<span class="st">&quot;./create_offspring_loop.cpp&quot;</span>)</span>
<span id="cb1-2"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-2"></a>Create_OffSpring_Pop_cpp<span class="ot">&lt;-</span><span class="cf">function</span>(host_pop,n_micro,env_pool,envpoolsize,X,fixed_envpool,</span>
<span id="cb1-3"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-3"></a>                                   selection_parameter_microbes,selection_parameter_hosts,microbe_trait_list, host_microbe_optima,</span>
<span id="cb1-4"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-4"></a>                                   N_Species,env_condition){</span>
<span id="cb1-5"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-5"></a>  </span>
<span id="cb1-6"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-6"></a>  microbe_names<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">&quot;Microbe&quot;</span>,<span class="dv">1</span><span class="sc">:</span>N_Species,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb1-7"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-7"></a>  ENV_sampling_probability<span class="ot">&lt;-</span>(env_pool)<span class="sc">/</span>envpoolsize <span class="co">#Calculate initial sampling probability based on environmental relative abundance</span></span>
<span id="cb1-8"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-8"></a>  <span class="fu">names</span>(ENV_sampling_probability)<span class="ot">&lt;-</span><span class="fu">names</span>(env_pool)</span>
<span id="cb1-9"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-9"></a>  offspring_population<span class="ot">&lt;-</span><span class="fu">offspring_loopfunc</span>(<span class="at">host_pop =</span> host_pop,<span class="at">ENV_sampling_probability =</span> ENV_sampling_probability,</span>
<span id="cb1-10"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-10"></a>                                           <span class="at">host_microbe_optima =</span> host_microbe_optima, <span class="at">X =</span> X,</span>
<span id="cb1-11"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-11"></a>                                           <span class="at">selection_parameter_microbes =</span> selection_parameter_microbes,</span>
<span id="cb1-12"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-12"></a>                                           <span class="at">env_condition =</span> env_condition,<span class="at">microbe_trait_list =</span> microbe_trait_list,</span>
<span id="cb1-13"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-13"></a>                                           <span class="at">n_micro =</span> n_micro,<span class="at">microbe_names =</span> microbe_names)</span>
<span id="cb1-14"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-14"></a>  offspring_population<span class="ot">&lt;-</span><span class="fu">list</span>(offspring_population<span class="sc">$</span>host_pop,env_pool,microbe_trait_list,offspring_population<span class="sc">$</span>fitness_microbes,</span>
<span id="cb1-15"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-15"></a>                             offspring_population<span class="sc">$</span>weighted_samplingprob)</span>
<span id="cb1-16"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-16"></a>  </span>
<span id="cb1-17"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-17"></a>  <span class="fu">names</span>(offspring_population)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;Child&quot;</span>,<span class="st">&quot;Env&quot;</span>,<span class="st">&quot;microbe_trait_list&quot;</span>,<span class="st">&quot;microbefitness&quot;</span>,<span class="st">&quot;microbe_samplingprob&quot;</span>)</span>
<span id="cb1-18"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-18"></a>  offspring_population</span>
<span id="cb1-19"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb1-19"></a>}</span></code></pre></div>
</div>
<div id="general-simulation-wrapper-code" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> General simulation wrapper code<a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#general-simulation-wrapper-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This code first works by calculating initial fitness values so we have them recorded. It loops over N generations, and within that loops over each microbial generation. For each bacterial generation, we start by generating a new environmental pool based on the previous pool, and fitness based selection. It does this by first using the process_microbe_probs C++ function. This takes in the environmental pool from the previous generation, the host population, and the environmental condition.</p>
</div>
<div id="generating-environmental-pools." class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Generating environmental pools.<a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#generating-environmental-pools." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Microbial fitness is determined based on the fitness calculation based on each microbes optima and the environmental condition. We then multiple the relative abundance and the fitness to the give the initial sampling probability for microbes in the environment. This determines the fitness based sampling for the environment, we then determine the relative abundance of each microbe in the fixed environment, and the host populations. Each microbes abundance is then multipled by its relative contribution to give its sampling probability.</p>
<p>For example, if hosts contribute 2% to the environment each generation, we would determine the relative abundance of microbes in the combined host population, and multiply that by 0.02 - the resulting values are the sampling probabilities for that microbe from the host. Next we would do the same for the fixed environment, so let’s say it’s 5% from the fixed environment - it would be relative abundance multiplied by 0.05. Finally we now have 93% that is determined by the previous generation and fitness. So we would multiply the fitness based sampling probabilities by 0.93.</p>
<p>We then sum all the sampling probabilities - and this gives us the ultimate sampling probability for that microbial generations environment.</p>
</div>
<div id="generating-new-microbiomes-within-a-host-generation" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Generating new microbiomes within a host generation<a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#generating-new-microbiomes-within-a-host-generation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>With the environmental pool now generated, we can generate a new microbiome for the hosts. This occurs with the process_host_cpp function, which determines the relative abundance of microbes in the environment, and in each host. We then calculate the fitness of each microbe when inside a host based on the mean of the host trait and the environmental condition. For example, if the environmental condition is 0.2 and the host optima is 0 - then the ‘ideal’ microbe has a trait value of 0.1. In this paper, we set all host trait values to 0.</p>
<p>Fitness is determined for each microbe, and we then undertake fitness based selection. First, some proportion (self_seeding) of the microbiome is retained from the previous generation, and the remainder is acquired from the environment. Thus we can again calculate relative abundances in the host and environment, multiply these by either the self_seeding proportion or 1-self_seeding. These values are then multipled by the fitness values for each microbe to give us a fitness adjusted sampling probability. Once again, we then used multinomial sampling to generate a new microbiome.</p>
</div>
<div id="generating-new-hosts" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Generating new hosts<a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#generating-new-hosts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After some determined number of microbial generations has passed, hosts can reproduce. These hosts are determined based on fitness. To do this, we calculate a ‘composite’ trait value for each host - which is the weighted mean trait values of their microbes. Therefore, the hosts innate trait value does not effect its fitness directly, but rather by adjusting its microbiome. We can calculate the mean microbial trait value for each host - and then based on the distance between the environmental condition and the composite trait value we can determine the fitness. The fitness is then used as a sampling probability for hosts, where we sample hosts to reproduce WITH replacement based on their fitness until we have a full population of hosts.</p>
<p>We then generate the new generation of hosts based on their parental microbiome. The parental microbiome is determined using the Create_OffSpring_Pop_cpp function discussed above.
## Clarify here how to save different elements of the data</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-1"></a>lapply_wrapper_CPP<span class="ot">&lt;-</span><span class="cf">function</span>(XY,</span>
<span id="cb2-2"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-2"></a>                             HostPopulation, N_Microbes, envpoolsize, env_pool,fixed_envpool,generations,per_host_bac_gens,self_seed_prop,</span>
<span id="cb2-3"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-3"></a>                             selection_parameter_hosts,selection_parameter_microbes,host_trait_list,N_Species,traitpool_microbes,</span>
<span id="cb2-4"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-4"></a>                             generation_data_file,selection_parameter_env,env_cond_val,</span>
<span id="cb2-5"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-5"></a>                             microbiome_importances,host_microbe_optima,mutation_rate,mutation_sd,print_currentgen){</span>
<span id="cb2-6"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-6"></a>  </span>
<span id="cb2-7"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-7"></a>  <span class="co">#Note: selection_parameter_hosts can be used to turn on, and adjust intensity of HS - when zero, host selection is off.</span></span>
<span id="cb2-8"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-8"></a>  <span class="co">#Similarly when selection_parameter_microbes is 0, we are using a neutral model, regardless of the given value of SelectionType. </span></span>
<span id="cb2-9"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-9"></a>  temp_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb2-10"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-10"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Current X Value is&quot;</span>, XY[<span class="dv">1</span>], <span class="st">&quot;Current EnvCon value is&quot;</span>, XY[<span class="dv">2</span>]))</span>
<span id="cb2-11"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-11"></a>  gen_data<span class="ot">&lt;-</span><span class="fu">list</span>()    </span>
<span id="cb2-12"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-12"></a>  microbe_names<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">&quot;Microbe&quot;</span>,<span class="dv">1</span><span class="sc">:</span>N_Species,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb2-13"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-13"></a></span>
<span id="cb2-14"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-14"></a>  env_used <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb2-15"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-15"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">nrow</span>(env_cond_val) <span class="sc">==</span> generations){</span>
<span id="cb2-16"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-16"></a>    <span class="fu">print</span>(<span class="st">&quot;env_cond_val should be a matrix of the same length as the number of generations you are simulating&quot;</span>)</span>
<span id="cb2-17"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-17"></a>    <span class="fu">stop</span>()</span>
<span id="cb2-18"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-18"></a>  }</span>
<span id="cb2-19"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-19"></a>  init_microbial_fitness<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow =</span> <span class="fu">length</span>(traitpool_microbes),<span class="at">ncol=</span><span class="fu">length</span>(host_microbe_optima))</span>
<span id="cb2-20"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-20"></a>  </span>
<span id="cb2-21"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-21"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(init_microbial_fitness)){</span>
<span id="cb2-22"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-22"></a>    init_microbial_fitness[,i] <span class="ot">&lt;-</span> <span class="fu">fitness_func_bacgen</span>(<span class="at">selection_parameter =</span> selection_parameter_microbes,</span>
<span id="cb2-23"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-23"></a>                                                      <span class="at">optima1 =</span> host_microbe_optima[i],</span>
<span id="cb2-24"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-24"></a>                                                      <span class="at">optima2 =</span> env_cond_val[<span class="dv">1</span>,<span class="dv">1</span>],<span class="at">trait =</span> traitpool_microbes)</span>
<span id="cb2-25"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-25"></a>  }</span>
<span id="cb2-26"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-26"></a>  init_microbial_fitness<span class="ot">&lt;-</span>init_microbial_fitness[HostPopulation<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb2-27"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-27"></a>  init_microbial_fitness<span class="ot">&lt;-</span><span class="fu">weighted.mean</span>(<span class="at">x =</span> init_microbial_fitness,<span class="at">w =</span> HostPopulation)</span>
<span id="cb2-28"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-28"></a></span>
<span id="cb2-29"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-29"></a>  init_host_fitness<span class="ot">&lt;-</span><span class="fu">vector</span>()</span>
<span id="cb2-30"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-30"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(HostPopulation)){</span>
<span id="cb2-31"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-31"></a>    mean_microbial_trait_val<span class="ot">&lt;-</span> <span class="fu">sum</span>(traitpool_microbes <span class="sc">*</span> HostPopulation[,i])<span class="sc">/</span>N_Microbes</span>
<span id="cb2-32"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-32"></a>    composite_host_trait<span class="ot">&lt;-</span>((mean_microbial_trait_val <span class="sc">*</span> microbiome_importances[i]) <span class="sc">+</span> (host_microbe_optima[i] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>microbiome_importances[i])))</span>
<span id="cb2-33"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-33"></a>    hostfitness<span class="ot">&lt;-</span><span class="fu">fitness_func</span>(<span class="at">selection_parameter =</span> selection_parameter_hosts, <span class="at">trait =</span> composite_host_trait,<span class="at">optima =</span> env_cond_val[<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb2-34"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-34"></a>    init_host_fitness[i]<span class="ot">&lt;-</span>hostfitness</span>
<span id="cb2-35"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-35"></a>  }</span>
<span id="cb2-36"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-36"></a>  </span>
<span id="cb2-37"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-37"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">ncol</span>(env_cond_val)<span class="sc">==</span>per_host_bac_gens){</span>
<span id="cb2-38"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-38"></a>    <span class="fu">print</span>(<span class="st">&quot;Number of columns in env_conditions should be the number of bacterial generations&quot;</span>)</span>
<span id="cb2-39"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-39"></a>    <span class="fu">stop</span>()</span>
<span id="cb2-40"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-40"></a>  }</span>
<span id="cb2-41"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-41"></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(self_seed_prop)){</span>
<span id="cb2-42"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-42"></a>    <span class="fu">print</span>(<span class="st">&quot;Self seeding proportion is NA, please correct&quot;</span>)</span>
<span id="cb2-43"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-43"></a>  }</span>
<span id="cb2-44"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-44"></a>  <span class="cf">for</span> (generation <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>generations) {</span>
<span id="cb2-45"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-45"></a>    <span class="cf">if</span>(generation <span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb2-46"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-46"></a>      env_used<span class="ot">&lt;-</span>fixed_envpool</span>
<span id="cb2-47"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-47"></a>    }</span>
<span id="cb2-48"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-48"></a>    <span class="cf">if</span>(per_host_bac_gens <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb2-49"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-49"></a>      self_seed_prop<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb2-50"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-50"></a>    }</span>
<span id="cb2-51"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-51"></a>    env_cond_val_used<span class="ot">&lt;-</span><span class="fu">as.vector</span>(env_cond_val[generation,])</span>
<span id="cb2-52"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-52"></a>    <span class="cf">for</span>(bacgen <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>per_host_bac_gens){</span>
<span id="cb2-53"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-53"></a>      </span>
<span id="cb2-54"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-54"></a>      <span class="cf">if</span>(XY[<span class="dv">2</span>] <span class="sc">+</span> XY[<span class="dv">3</span>] <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb2-55"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-55"></a>        <span class="fu">print</span>(<span class="st">&quot;The contribution of the fixed environment (Y) and the the autocthonous environment (var_env_con) is greater than 1, please correct this &quot;</span>)</span>
<span id="cb2-56"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-56"></a>        <span class="fu">stop</span>()</span>
<span id="cb2-57"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-57"></a>      }</span>
<span id="cb2-58"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-58"></a>      gen_env_cond<span class="ot">&lt;-</span>env_cond_val_used[bacgen]</span>
<span id="cb2-59"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-59"></a>      env_used<span class="ot">&lt;-</span><span class="fu">process_microbe_probs</span>(<span class="at">env_cond_val =</span> gen_env_cond,</span>
<span id="cb2-60"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-60"></a>                                      <span class="at">fixed_envpool =</span> fixed_envpool,</span>
<span id="cb2-61"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-61"></a>                                      <span class="at">HostPopulation =</span> HostPopulation,</span>
<span id="cb2-62"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-62"></a>                                      <span class="at">N_Microbes =</span> N_Microbes,</span>
<span id="cb2-63"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-63"></a>                                      <span class="at">envpoolsize =</span> envpoolsize,</span>
<span id="cb2-64"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-64"></a>                                      <span class="at">selection_parameter_env =</span> selection_parameter_env,</span>
<span id="cb2-65"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-65"></a>                                      <span class="at">XY =</span> XY,</span>
<span id="cb2-66"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-66"></a>                                      <span class="at">traitpool_microbes =</span> traitpool_microbes,<span class="at">env_used =</span> env_used</span>
<span id="cb2-67"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-67"></a>      )<span class="co">#[,8]</span></span>
<span id="cb2-68"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-68"></a>      env_fits<span class="ot">&lt;-</span><span class="fu">weighted.mean</span>(<span class="at">x =</span> env_used[,<span class="dv">3</span>],<span class="at">w =</span> env_used[,<span class="dv">8</span>])</span>
<span id="cb2-69"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-69"></a>      env_used<span class="ot">&lt;-</span>env_used[,<span class="dv">8</span>]        </span>
<span id="cb2-70"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-70"></a>      <span class="fu">names</span>(env_used)<span class="ot">&lt;-</span><span class="fu">names</span>(fixed_envpool)</span>
<span id="cb2-71"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-71"></a>      HostPopulation<span class="ot">&lt;-</span><span class="fu">process_host_cpp</span>(<span class="at">HostPopulation =</span> HostPopulation,</span>
<span id="cb2-72"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-72"></a>                                       <span class="at">selection_parameter_microbes =</span> selection_parameter_microbes,</span>
<span id="cb2-73"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-73"></a>                                       <span class="at">host_microbe_optima =</span> host_microbe_optima ,</span>
<span id="cb2-74"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-74"></a>                                       <span class="at">env_condition =</span> env_cond_val_used[bacgen],</span>
<span id="cb2-75"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-75"></a>                                       <span class="at">traitpool_microbes =</span> traitpool_microbes,</span>
<span id="cb2-76"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-76"></a>                                       <span class="at">N_Microbes =</span> N_Microbes, </span>
<span id="cb2-77"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-77"></a>                                       <span class="at">self_seed_prop =</span> self_seed_prop,<span class="at">env_used =</span> env_used)</span>
<span id="cb2-78"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-78"></a>    }</span>
<span id="cb2-79"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-79"></a>    <span class="co">#Now we&#39;ve created our new environments, we now need to choose which members of a population reproduce</span></span>
<span id="cb2-80"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-80"></a>    <span class="co"># We can do this either neutrally (i.e., random chance) OR we can do this based on the fitness of a host based on what is provided by its microbiome</span></span>
<span id="cb2-81"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-81"></a>    host_fitnessvector<span class="ot">&lt;-</span><span class="fu">numeric</span>()</span>
<span id="cb2-82"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-82"></a>    host_fitnessvector <span class="ot">&lt;-</span> <span class="fu">calculate_host_fitness_cpp</span>(<span class="fu">as.matrix</span>(HostPopulation), </span>
<span id="cb2-83"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-83"></a>                                                     traitpool_microbes, microbiome_importances, </span>
<span id="cb2-84"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-84"></a>                                                     host_microbe_optima, </span>
<span id="cb2-85"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-85"></a>                                                     selection_parameter_hosts, env_cond_val_used[per_host_bac_gens])</span>
<span id="cb2-86"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-86"></a>    nomicrobiomehost_fitnessvector<span class="ot">&lt;-</span><span class="fu">numeric</span>()</span>
<span id="cb2-87"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-87"></a>    nomicrobiomehost_fitnessvector <span class="ot">&lt;-</span> <span class="fu">calculate_host_fitness_cpp</span>(<span class="fu">as.matrix</span>(HostPopulation), </span>
<span id="cb2-88"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-88"></a>                                                                 traitpool_microbes,<span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(microbiome_importances)), </span>
<span id="cb2-89"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-89"></a>                                                                 host_microbe_optima, </span>
<span id="cb2-90"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-90"></a>                                                                 selection_parameter_hosts, env_cond_val_used[per_host_bac_gens])</span>
<span id="cb2-91"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-91"></a>    </span>
<span id="cb2-92"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-92"></a>    hostfitness_abs<span class="ot">&lt;-</span>host_fitnessvector</span>
<span id="cb2-93"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-93"></a>    host_fitnessvector<span class="ot">&lt;-</span>host_fitnessvector<span class="co">#/mean(host_fitnessvector)</span></span>
<span id="cb2-94"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-94"></a>    </span>
<span id="cb2-95"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-95"></a>    HostPopulationInt<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="fu">colnames</span>(HostPopulation),<span class="fu">ncol</span>(HostPopulation),<span class="at">replace =</span> T,<span class="at">prob =</span> host_fitnessvector)</span>
<span id="cb2-96"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-96"></a>    host_microbe_optima_prevgen<span class="ot">&lt;-</span>host_microbe_optima</span>
<span id="cb2-97"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-97"></a>    </span>
<span id="cb2-98"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-98"></a>    HostPopulation<span class="ot">&lt;-</span>HostPopulation[ , HostPopulationInt]</span>
<span id="cb2-99"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-99"></a>    host_microbe_optima<span class="ot">&lt;-</span>host_microbe_optima[HostPopulationInt]</span>
<span id="cb2-100"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-100"></a>    microbiome_importances<span class="ot">&lt;-</span>microbiome_importances[HostPopulationInt]</span>
<span id="cb2-101"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-101"></a>    </span>
<span id="cb2-102"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-102"></a>    <span class="cf">if</span>(mutation_rate<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb2-103"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-103"></a>      host_microbe_optima <span class="ot">&lt;-</span> <span class="fu">mutate_trait</span>(host_microbe_optima, mutation_rate, mutation_sd)</span>
<span id="cb2-104"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-104"></a>    }</span>
<span id="cb2-105"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-105"></a>    </span>
<span id="cb2-106"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-106"></a>    </span>
<span id="cb2-107"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-107"></a>    <span class="fu">colnames</span>(HostPopulation)<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">&quot;Host&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(HostPopulation),<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb2-108"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-108"></a>    <span class="fu">names</span>(host_microbe_optima)<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">&quot;Host&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(HostPopulation),<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb2-109"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-109"></a>    <span class="fu">names</span>(microbiome_importances)<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">&quot;Host&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(HostPopulation),<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb2-110"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-110"></a>    <span class="cf">if</span>(print_currentgen<span class="sc">==</span>T){<span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Current Generation is&quot;</span>, generation))}</span>
<span id="cb2-111"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-111"></a>    new_gen <span class="ot">&lt;-</span> <span class="fu">Create_OffSpring_Pop_cpp</span>(<span class="at">host_pop =</span> HostPopulation,</span>
<span id="cb2-112"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-112"></a>                                        <span class="at">n_micro =</span> N_Microbes,</span>
<span id="cb2-113"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-113"></a>                                        <span class="at">env_pool =</span> env_used,</span>
<span id="cb2-114"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-114"></a>                                        <span class="at">envpoolsize =</span> envpoolsize,</span>
<span id="cb2-115"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-115"></a>                                        <span class="at">X =</span> XY[<span class="dv">1</span>],</span>
<span id="cb2-116"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-116"></a>                                        <span class="at">fixed_envpool =</span> fixed_envpool, </span>
<span id="cb2-117"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-117"></a>                                        <span class="at">microbe_trait_list=</span>traitpool_microbes,</span>
<span id="cb2-118"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-118"></a>                                        <span class="at">selection_parameter_microbes=</span>selection_parameter_microbes,</span>
<span id="cb2-119"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-119"></a>                                        <span class="at">selection_parameter_hosts =</span> selection_parameter_hosts,</span>
<span id="cb2-120"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-120"></a>                                        <span class="at">host_microbe_optima=</span>host_microbe_optima,</span>
<span id="cb2-121"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-121"></a>                                        <span class="at">N_Species=</span>N_Species,</span>
<span id="cb2-122"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-122"></a>                                        <span class="at">env_condition=</span>env_cond_val_used[per_host_bac_gens])</span>
<span id="cb2-123"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-123"></a>    <span class="co"># print(&quot;Issue here&quot;)</span></span>
<span id="cb2-124"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-124"></a>    HostPopulation <span class="ot">&lt;-</span> new_gen<span class="sc">$</span>Child</span>
<span id="cb2-125"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-125"></a>    BrayDiv<span class="ot">&lt;-</span><span class="fu">vegdist</span>(<span class="fu">t</span>(HostPopulation),<span class="at">method=</span><span class="st">&quot;bray&quot;</span>)</span>
<span id="cb2-126"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-126"></a>    div_pergen<span class="ot">&lt;-</span><span class="fu">calc_div</span>(<span class="fu">t</span>(new_gen<span class="sc">$</span>Child))<span class="sc">/</span><span class="fu">log</span>(<span class="fu">calc_rich</span>(new_gen<span class="sc">$</span>Child))</span>
<span id="cb2-127"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-127"></a>    new_gen<span class="sc">$</span>HostFitness_Abs<span class="ot">&lt;-</span>(hostfitness_abs)</span>
<span id="cb2-128"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-128"></a>    new_gen<span class="sc">$</span>nomicrobiomehost_fitnessvector<span class="ot">&lt;-</span>nomicrobiomehost_fitnessvector</span>
<span id="cb2-129"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-129"></a>    new_gen<span class="sc">$</span>BrayDiv<span class="ot">&lt;-</span>BrayDiv</span>
<span id="cb2-130"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-130"></a>    new_gen<span class="sc">$</span>HostMicrobeOptima<span class="ot">&lt;-</span>host_microbe_optima_prevgen</span>
<span id="cb2-131"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-131"></a>    gen_data[[generation]]<span class="ot">&lt;-</span><span class="fu">list</span>(div_pergen,new_gen<span class="sc">$</span>HostFitness_Abs,new_gen<span class="sc">$</span>microbefitness,env_used,</span>
<span id="cb2-132"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-132"></a>                                 env_fits,new_gen<span class="sc">$</span>HostMicrobeOptima,new_gen<span class="sc">$</span>nomicrobiomehost_fitnessvector,new_gen<span class="sc">$</span>microbe_samplingprob,</span>
<span id="cb2-133"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-133"></a>                                 microbiome_importances,new_gen<span class="sc">$</span>BrayDiv)</span>
<span id="cb2-134"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-134"></a>    <span class="fu">names</span>(gen_data[[generation]])<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;Diversity&quot;</span>,<span class="st">&quot;HostFitness&quot;</span>,<span class="st">&quot;MicrobeFitness&quot;</span>,<span class="st">&quot;env_used&quot;</span>,<span class="st">&quot;env_fits&quot;</span></span>
<span id="cb2-135"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-135"></a>                                     ,<span class="st">&quot;HostMicrobeOptima&quot;</span>,<span class="st">&quot;nomicrobiomehost_fitnessvector&quot;</span>,</span>
<span id="cb2-136"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-136"></a>                                     <span class="st">&quot;microbe_samplingprob&quot;</span>,<span class="st">&quot;microbiome_importances&quot;</span>,<span class="st">&quot;BrayDiv&quot;</span>)<span class="co">#,&quot;HostPrefOptima&quot;,&quot;HostMicrobeOptima&quot;)</span></span>
<span id="cb2-137"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-137"></a>  }</span>
<span id="cb2-138"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-138"></a>  new_gen<span class="sc">$</span>GenData<span class="ot">&lt;-</span>gen_data</span>
<span id="cb2-139"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-139"></a>  new_gen<span class="sc">$</span>init_host_fitness<span class="ot">&lt;-</span>init_host_fitness</span>
<span id="cb2-140"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-140"></a>  new_gen<span class="sc">$</span>init_microbe_fitness<span class="ot">&lt;-</span>init_microbial_fitness</span>
<span id="cb2-141"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-141"></a></span>
<span id="cb2-142"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-142"></a>  temp_list[[<span class="fu">paste0</span>(<span class="st">&quot;X&quot;</span>, XY[<span class="dv">1</span>], <span class="st">&quot;_Y&quot;</span>, XY[<span class="dv">2</span>],<span class="st">&quot;_EnvCont&quot;</span>,XY[<span class="dv">3</span>],<span class="st">&quot;_HostSel&quot;</span>,XY[<span class="dv">4</span>],<span class="st">&quot;_MicrobeSel&quot;</span>,XY[<span class="dv">5</span>])]] <span class="ot">&lt;-</span> new_gen</span>
<span id="cb2-143"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-143"></a>  temp_list</span>
<span id="cb2-144"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb2-144"></a>}</span></code></pre></div>
</div>
<div id="unused-functions-and-capacities" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Unused functions and capacities<a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#unused-functions-and-capacities" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Because we intend to use this simulation framework for a range of studies, we have intentionally developed it with a lot of unused functions and capacities. For example, we include the “mutate_trait” value, and we allow for host traits to be variable. We do not utilize these here.</p>
</div>
<div id="running-a-simulation" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Running a simulation<a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#running-a-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb3-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-2"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb3-2"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb3-3"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb3-3"></a><span class="fu">library</span>(Rcpp)</span>
<span id="cb3-4"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb3-4"></a><span class="fu">library</span>(vegan)</span></code></pre></div>
<pre><code>## Loading required package: permute</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## This is vegan 2.5-7</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb7-1"></a><span class="fu">library</span>(flair)</span>
<span id="cb7-2"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb7-2"></a><span class="fu">library</span>(parallel)</span>
<span id="cb7-3"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb7-3"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb11-1"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-2"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-2"></a>calc_rich<span class="ot">&lt;-</span><span class="cf">function</span>(population){</span>
<span id="cb11-3"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-3"></a>  population[population<span class="sc">&gt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span>T</span>
<span id="cb11-4"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-4"></a>  <span class="fu">colSums</span>(population)</span>
<span id="cb11-5"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-5"></a>}</span>
<span id="cb11-6"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-6"></a>fast_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb11-7"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-7"></a>  x<span class="ot">&lt;-</span>x[<span class="sc">!</span><span class="fu">is.na</span>(x)]</span>
<span id="cb11-8"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-8"></a>  <span class="fu">sum</span>(x) <span class="sc">/</span> <span class="fu">length</span>(x)</span>
<span id="cb11-9"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-9"></a>} </span>
<span id="cb11-10"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-10"></a></span>
<span id="cb11-11"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-11"></a>calc_div<span class="ot">&lt;-</span><span class="cf">function</span>(population){</span>
<span id="cb11-12"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-12"></a>  relabund<span class="ot">&lt;-</span>population<span class="sc">/</span><span class="fu">rowSums</span>(population)</span>
<span id="cb11-13"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-13"></a>  <span class="sc">-</span> <span class="fu">rowSums</span>(relabund<span class="sc">*</span> <span class="fu">log</span>(relabund))</span>
<span id="cb11-14"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-14"></a>}</span>
<span id="cb11-15"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-15"></a></span>
<span id="cb11-16"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-16"></a>fitness_func <span class="ot">&lt;-</span> <span class="cf">function</span>(selection_parameter, optima, trait) {</span>
<span id="cb11-17"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-17"></a>  q <span class="ot">=</span> <span class="fu">exp</span>(((trait <span class="sc">-</span> optima)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="sc">-</span>selection_parameter)</span>
<span id="cb11-18"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-18"></a>  q</span>
<span id="cb11-19"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-19"></a>}</span>
<span id="cb11-20"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-20"></a></span>
<span id="cb11-21"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-21"></a></span>
<span id="cb11-22"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-22"></a>fitness_func_bacgen <span class="ot">&lt;-</span> <span class="cf">function</span>(selection_parameter,optima1, optima2, trait) {</span>
<span id="cb11-23"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-23"></a>  q <span class="ot">=</span> <span class="fu">exp</span>((((trait <span class="sc">-</span> <span class="fu">mean</span>(<span class="fu">c</span>(optima1, optima2)))<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span> <span class="sc">-</span>selection_parameter)</span>
<span id="cb11-24"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-24"></a>  q</span>
<span id="cb11-25"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-25"></a>}</span>
<span id="cb11-26"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-26"></a></span>
<span id="cb11-27"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-27"></a>mutate_trait <span class="ot">&lt;-</span> <span class="cf">function</span>(trait, mutation_rate, mutation_sd) {</span>
<span id="cb11-28"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-28"></a>  mutated_trait <span class="ot">&lt;-</span> trait <span class="co">#+ rnorm(length(trait), mean = 0, sd = mutation_sd)</span></span>
<span id="cb11-29"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-29"></a>  mutate_mask <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fu">length</span>(trait)) <span class="sc">&lt;</span> mutation_rate</span>
<span id="cb11-30"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-30"></a>  mutated_trait[mutate_mask] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">sum</span>(mutate_mask), <span class="at">mean =</span> mutated_trait[mutate_mask], <span class="at">sd =</span> mutation_sd)</span>
<span id="cb11-31"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-31"></a>  mutated_trait</span>
<span id="cb11-32"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-32"></a>}</span>
<span id="cb11-33"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-33"></a></span>
<span id="cb11-34"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-34"></a></span>
<span id="cb11-35"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-35"></a>Rcpp<span class="sc">::</span><span class="fu">sourceCpp</span>(<span class="st">&#39;./calccpp_fit.cpp&#39;</span>)</span>
<span id="cb11-36"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-36"></a><span class="fu">sourceCpp</span>(<span class="st">&quot;./withingen_process.cpp&quot;</span>)</span>
<span id="cb11-37"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-37"></a><span class="fu">sourceCpp</span>(<span class="st">&quot;./env_production_withingen.cpp&quot;</span>)</span>
<span id="cb11-38"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-38"></a></span>
<span id="cb11-39"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-39"></a></span>
<span id="cb11-40"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-40"></a></span>
<span id="cb11-41"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb11-41"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>In our code we retain a lot information such as diversity, phenotypes/composite trait values, betadiversity, fitnesses, etc. It is better to calculate these as the simulation progresses rather than retaining every single generations data - because it is a lot of data that has to be saved and stored.</p>
<p>We will start by generating an environmental matrix. This should be as many rows as you have host generations, and as many columns as you have microbial generations. In our paper, we generate environmental conditions for host generations, and interpolate between them smoothly for microbial generations, as seen in the code below. I will use an example environment here for white noise, similar to what is presented in our paper - the actual code for our environmental conditions is elsewhere in this repository. Below we present two plots - the first is at the scale of microbial generations based on 10 microbial generations per host generation. Hence it has 1,500 values - and is the result of smoothly interpolating between the environmental values at the host time scale (150 generations, the second plot).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb12-1"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-1"></a>N_HostGens<span class="ot">=</span><span class="dv">150</span></span>
<span id="cb12-2"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-2"></a>start <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="at">length.out =</span> N_HostGens<span class="sc">*</span><span class="fl">0.2</span>)</span>
<span id="cb12-3"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-3"></a>mid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="at">length.out =</span> N_HostGens<span class="sc">*</span><span class="fl">0.8</span>)</span>
<span id="cb12-4"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-4"></a>lowac_incvar<span class="ot">&lt;-</span><span class="fu">sapply</span>(<span class="fu">c</span>(start,mid)<span class="sc">*</span><span class="fl">2.8</span>, <span class="cf">function</span>(x){<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,x)})</span>
<span id="cb12-5"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-5"></a>expand_vector<span class="ot">&lt;-</span><span class="cf">function</span>(vector, N) {</span>
<span id="cb12-6"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-6"></a>  expanded_vector <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb12-7"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-7"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(vector) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb12-8"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-8"></a>    expanded_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(expanded_vector, vector[i], <span class="fu">seq</span>(vector[i], vector[i <span class="sc">+</span> <span class="dv">1</span>], <span class="at">length.out =</span> N))</span>
<span id="cb12-9"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-9"></a>  }</span>
<span id="cb12-10"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-10"></a>  <span class="fu">return</span>(expanded_vector[<span class="dv">1</span><span class="sc">:</span>(N<span class="sc">*</span><span class="dv">150</span>)])</span>
<span id="cb12-11"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-11"></a>}</span>
<span id="cb12-12"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-12"></a>env_vec<span class="ot">&lt;-</span><span class="fu">expand_vector</span>(lowac_incvar,<span class="dv">10</span>)</span>
<span id="cb12-13"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-13"></a>new_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(env_vec,<span class="at">nrow =</span> <span class="dv">150</span>,<span class="at">ncol =</span> <span class="dv">10</span>,<span class="at">byrow =</span> T)</span>
<span id="cb12-14"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-14"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb12-15"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-15"></a><span class="fu">plot</span>(env_vec,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1500</span>),<span class="at">ylab=</span><span class="st">&quot;Environmental Condition&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;Time point&quot;</span>)</span>
<span id="cb12-16"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb12-16"></a><span class="fu">plot</span>(new_mat[,<span class="dv">1</span>],<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">150</span>),<span class="at">ylab=</span><span class="st">&quot;Environmental Condition&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;Host Generation&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>Now we can run a simulation:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb13-1"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-1"></a>Host_PopSize<span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb13-2"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-2"></a>MicrobePopSize<span class="ot">=</span><span class="dv">10</span><span class="sc">^</span><span class="dv">9</span></span>
<span id="cb13-3"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-3"></a>EnvPoolSize<span class="ot">=</span><span class="dv">10</span><span class="sc">^</span><span class="dv">9</span></span>
<span id="cb13-4"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-4"></a>N_Species <span class="ot">=</span><span class="dv">200</span></span>
<span id="cb13-5"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-5"></a></span>
<span id="cb13-6"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-6"></a>InitPopulation<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="at">nrow =</span> N_Species, <span class="at">ncol=</span>Host_PopSize)</span>
<span id="cb13-7"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-7"></a>InitPopulation<span class="ot">&lt;-</span><span class="fu">apply</span>(InitPopulation,<span class="at">MARGIN=</span><span class="dv">2</span>,<span class="at">FUN=</span><span class="cf">function</span>(x){</span>
<span id="cb13-8"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-8"></a>  <span class="fu">rmultinom</span>(<span class="at">n=</span><span class="dv">1</span>,<span class="at">size =</span> MicrobePopSize, <span class="at">prob =</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span>N_Species,N_Species))</span>
<span id="cb13-9"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-9"></a>})</span>
<span id="cb13-10"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-10"></a><span class="fu">rownames</span>(InitPopulation)<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">&quot;Microbe&quot;</span>,<span class="dv">1</span><span class="sc">:</span>N_Species,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb13-11"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-11"></a><span class="fu">colnames</span>(InitPopulation)<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">&quot;Host&quot;</span>,<span class="dv">1</span><span class="sc">:</span>Host_PopSize,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb13-12"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-12"></a></span>
<span id="cb13-13"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-13"></a>EnvPool<span class="ot">&lt;-</span><span class="fu">rep</span>(EnvPoolSize<span class="sc">/</span>N_Species,N_Species)</span>
<span id="cb13-14"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-14"></a><span class="fu">names</span>(EnvPool)<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">&quot;Microbe&quot;</span>,<span class="dv">1</span><span class="sc">:</span>N_Species,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb13-15"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-15"></a>fixed_envpool<span class="ot">&lt;-</span>EnvPool</span>
<span id="cb13-16"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-16"></a></span>
<span id="cb13-17"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-17"></a>traitpool_microbes<span class="ot">&lt;-</span><span class="fu">runif</span>(N_Species,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb13-18"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-18"></a><span class="fu">names</span>(traitpool_microbes)<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">&quot;Microbe&quot;</span>,<span class="dv">1</span><span class="sc">:</span>N_Species,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb13-19"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-19"></a>mnames<span class="ot">&lt;-</span><span class="fu">colnames</span>(InitPopulation)</span>
<span id="cb13-20"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-20"></a>host_microbe_optima<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="dv">0</span>,Host_PopSize)</span>
<span id="cb13-21"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-21"></a></span>
<span id="cb13-22"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-22"></a><span class="fu">names</span>(host_microbe_optima)<span class="ot">&lt;-</span>mnames</span>
<span id="cb13-23"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-23"></a>microbiome_importances<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="dv">1</span>,Host_PopSize)</span>
<span id="cb13-24"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-24"></a><span class="fu">names</span>(microbiome_importances)<span class="ot">&lt;-</span>mnames</span>
<span id="cb13-25"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-25"></a></span>
<span id="cb13-26"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-26"></a></span>
<span id="cb13-27"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-27"></a>combination<span class="ot">=</span><span class="fu">c</span>(</span>
<span id="cb13-28"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-28"></a>  <span class="fl">0.5</span>, <span class="co">#Proportion of vertical inheritance</span></span>
<span id="cb13-29"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-29"></a>  <span class="fl">0.05</span>, <span class="co">#Proportion of host &#39;shedding&#39; to the environment.</span></span>
<span id="cb13-30"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-30"></a>  <span class="fl">0.8</span>) <span class="co">#Proportion of environmental pool which contributes to subsequent environmental pool.</span></span>
<span id="cb13-31"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-31"></a></span>
<span id="cb13-32"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-32"></a>simulation_test <span class="ot">&lt;-</span> <span class="fu">lapply_wrapper_CPP</span>(</span>
<span id="cb13-33"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-33"></a>    <span class="at">XY =</span> combination,</span>
<span id="cb13-34"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-34"></a>    <span class="at">HostPopulation =</span> InitPopulation,</span>
<span id="cb13-35"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-35"></a>    <span class="at">N_Microbes =</span> MicrobePopSize,</span>
<span id="cb13-36"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-36"></a>    <span class="at">envpoolsize =</span> EnvPoolSize,</span>
<span id="cb13-37"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-37"></a>    <span class="at">env_pool =</span> EnvPool,</span>
<span id="cb13-38"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-38"></a>    <span class="at">generations =</span> <span class="fu">nrow</span>(new_mat),</span>
<span id="cb13-39"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-39"></a>    <span class="at">fixed_envpool =</span> fixed_envpool,</span>
<span id="cb13-40"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-40"></a>    <span class="at">selection_parameter_hosts =</span> <span class="dv">1</span>,</span>
<span id="cb13-41"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-41"></a>    <span class="at">selection_parameter_microbes =</span> <span class="dv">1</span>,</span>
<span id="cb13-42"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-42"></a>    <span class="at">traitpool_microbes =</span> traitpool_microbes,</span>
<span id="cb13-43"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-43"></a>    <span class="at">host_microbe_optima =</span> host_microbe_optima,</span>
<span id="cb13-44"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-44"></a>    <span class="at">selection_parameter_env =</span> <span class="dv">1</span>,</span>
<span id="cb13-45"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-45"></a>    <span class="at">env_cond_val =</span> new_mat,</span>
<span id="cb13-46"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-46"></a>    <span class="at">N_Species =</span> N_Species,</span>
<span id="cb13-47"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-47"></a>    <span class="at">microbiome_importances =</span> microbiome_importances,</span>
<span id="cb13-48"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-48"></a>    <span class="at">per_host_bac_gens =</span> <span class="fu">ncol</span>(new_mat),</span>
<span id="cb13-49"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-49"></a>    <span class="at">self_seed_prop =</span> <span class="fl">0.98</span>,</span>
<span id="cb13-50"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-50"></a>    <span class="at">generation_data_file =</span> <span class="cn">NA</span>,</span>
<span id="cb13-51"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-51"></a>    <span class="at">mutation_rate =</span> <span class="fl">0.0</span>,</span>
<span id="cb13-52"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-52"></a>    <span class="at">mutation_sd =</span> <span class="fl">0.0</span>,</span>
<span id="cb13-53"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-53"></a>    <span class="at">print_currentgen =</span> F</span>
<span id="cb13-54"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb13-54"></a>  )</span></code></pre></div>
<pre><code>## [1] &quot;Current X Value is 0.5 Current EnvCon value is 0.05&quot;</code></pre>
<p>We’ve done a simulation above, so here I will just make a demonstration figure. Most of the useful data is stored within “GenData” - which contains data from every host generation.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb15-1"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb15-1"></a>MicrobialFitnesses<span class="ot">&lt;-</span><span class="fu">vector</span>()</span>
<span id="cb15-2"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb15-2"></a>HostFitnesses<span class="ot">&lt;-</span><span class="fu">vector</span>()</span>
<span id="cb15-3"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb15-3"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(simulation_test[[<span class="dv">1</span>]]<span class="sc">$</span>GenData)){</span>
<span id="cb15-4"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb15-4"></a>  MicrobialFitnesses[i]<span class="ot">&lt;-</span> <span class="fu">mean</span>(simulation_test[[<span class="dv">1</span>]]<span class="sc">$</span>GenData[[i]]<span class="sc">$</span>MicrobeFitness)</span>
<span id="cb15-5"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb15-5"></a>  HostFitnesses[i]<span class="ot">&lt;-</span>  <span class="fu">mean</span>(simulation_test[[<span class="dv">1</span>]]<span class="sc">$</span>GenData[[i]]<span class="sc">$</span>HostFitness)</span>
<span id="cb15-6"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb15-6"></a>}</span>
<span id="cb15-7"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb15-7"></a></span>
<span id="cb15-8"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb15-8"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb15-9"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb15-9"></a><span class="fu">plot</span>(HostFitnesses,<span class="at">xlab=</span><span class="st">&quot;Generation&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;Host Fitness&quot;</span>)</span>
<span id="cb15-10"><a href="paper-1---joint-consideration-of-selection-and-microbial-generation-count-provides-unique-insights-into-evolutionary-and-ecological-dynamics-of-holobionts.html#cb15-10"></a><span class="fu">plot</span>(MicrobialFitnesses,<span class="at">xlab=</span><span class="st">&quot;Generation&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;Microbial Fitness&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="paper-1---effective-vertical-inheritance.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-paper1_main.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
